# v1.2.0 新功能说明

## 🎉 本次更新亮点

v1.2.0 版本新增了两个实用功能，让您的使用体验更加流畅！

---

## 功能 1：项目切换智能检测 🔔

### 功能说明

当您切换到新项目时，扩展会自动检测该项目是否已初始化 sy-ai-commit。如果未初始化，会弹出友好的提示。

### 使用场景

**场景一：切换到全新项目**
```
您打开了一个新的项目 → 扩展自动检测到未初始化 → 弹出提示窗口
```

**提示内容：**
```
⚠️ 当前项目未初始化 sy-ai-commit

检测到您切换了项目，但当前项目未配置 sy-ai-commit。
是否立即初始化？

[立即初始化]  [稍后]  [不再提示]
```

**场景二：项目有 .cursorrules 但缺少 Git 规则**
```
您打开了一个项目，有 .cursorrules 文件但未包含 Git 提交规则 → 弹出提示
```

**提示内容：**
```
⚠️ 当前项目的 .cursorrules 未包含 Git 提交规则

是否要添加 sy-ai-commit 的 Git 提交规则？

[添加规则]  [稍后]
```

### 触发时机

1. **工作区切换**：当您打开新项目或切换工作区时自动触发
2. **扩展激活**：扩展激活后延迟 2 秒自动检测一次（避免与首次配置冲突）

### 检测逻辑

```typescript
1. 检查项目根目录是否存在 .cursorrules 文件
   - 不存在 → 提示"未初始化"
   - 存在 → 继续检查

2. 检查 .cursorrules 文件内容
   - 包含 "When generating git commit messages" → 已配置 ✓
   - 不包含 → 提示"未包含 Git 提交规则"
```

### 用户选项

| 选项 | 说明 |
|------|------|
| **立即初始化** / **添加规则** | 立即执行配置，自动完成所有设置 |
| **稍后** | 关闭提示，下次切换项目时会再次提示 |
| **不再提示** | 关闭提示，并在当前工作区不再提示 |

### 注意事项

- ✅ 不会干扰您的正常工作，提示是非模态的（可以点击其他地方关闭）
- ✅ 已初始化的项目不会弹出提示
- ✅ 选择"不再提示"后，该项目不会再提示，但可以手动运行配置命令

---

## 功能 2：提交信息即时预览 📝

### 功能说明

使用 `Ctrl+T Ctrl+T` 生成提交信息后，成功弹窗会直接显示生成的提交信息内容，无需切换到源代码管理面板即可预览。

### 使用演示

**旧版本（v1.1.9）：**
```
按 Ctrl+T Ctrl+T → 弹窗提示"已生成" → 需要打开源代码管理面板查看
```

**新版本（v1.2.0）：**
```
按 Ctrl+T Ctrl+T → 弹窗直接显示生成的提交信息内容 → 可以立即预览
```

### 弹窗示例

```
✅ 已生成提交信息！

📝 生成的提交信息：
━━━━━━━━━━━━━━━━━━━━
Feat(用户模块): 添加用户登录功能

- 实现用户名密码登录
- 添加记住密码功能
- 优化登录页面UI

Generated-by: sy-ai-commit@1.2.0
━━━━━━━━━━━━━━━━━━━━

👉 下一步：查看提交信息并点击"提交"按钮（或按 Ctrl+Enter）

[打开源代码管理]  [知道了]
```

### 长文本处理

如果生成的提交信息超过 300 字符，会自动截断并提示：

```
✅ 已生成提交信息！

📝 生成的提交信息：
━━━━━━━━━━━━━━━━━━━━
Feat(项目重构): 重构整个项目架构

- 重构前端组件结构，使用模块化设计
- 优化后端 API 接口，提升性能
- 更新数据库结构，添加新表
- 实现缓存机制，减少数据库查询
- 添加单元测试和集成测试
- 更新文档，添加 API 说明
- 优化构建流程，减少打包时间
- 修复已知 bug 20+ 个
...

(完整内容请在源代码管理面板查看)
━━━━━━━━━━━━━━━━━━━━

👉 下一步：查看提交信息并点击"提交"按钮（或按 Ctrl+Enter）

[打开源代码管理]  [知道了]
```

### 优势

| 对比项 | 旧版本 | 新版本 |
|--------|--------|--------|
| **查看方式** | 必须打开源代码管理面板 | 弹窗直接显示 |
| **操作步骤** | 3 步（生成 → 打开面板 → 查看） | 1 步（生成即可看到） |
| **用户体验** | 需要切换视图 | 即时反馈 |
| **适用场景** | 所有场景 | 快速预览 + 详细查看 |

### 使用建议

1. **快速预览**：生成后直接在弹窗中查看，确认格式和内容
2. **详细审查**：如果提交信息较长，点击"打开源代码管理"查看完整内容
3. **快速提交**：如果预览无误，直接在源代码管理面板点击"提交"

---

## 其他优化

### 使用统计功能

- 自动在提交信息末尾添加 `Generated-by: sy-ai-commit@版本号` 标记
- 可通过 Git 命令查看使用统计
- 支持配置开关，用户完全可控

**查看统计示例：**
```bash
# 统计使用次数
git log --grep="Generated-by: sy-ai-commit" --oneline | wc -l

# 本月使用次数
git log --grep="Generated-by: sy-ai-commit" --since="1 month ago" --oneline | wc -l
```

---

## 升级指南

### 从 v1.1.9 升级

1. **更新扩展**：在扩展市场更新到 v1.2.0
2. **无需重新配置**：已配置的项目无需任何操作
3. **新功能自动生效**：
   - 项目切换检测：自动启用
   - 提交信息预览：自动启用
   - 使用统计标记：默认启用（可在设置中关闭）

### 配置项（可选）

如果不希望添加使用统计标记，可以在设置中关闭：

```json
{
  "autoCommitAssistant.addGeneratedByTrailer": false
}
```

---

## 常见问题

**Q: 为什么切换项目时没有弹出初始化提示？**  
A: 可能原因：
1. 项目已经初始化过了
2. 您之前选择了"不再提示"
3. 工作区切换事件未触发

解决方法：手动运行 `sy commit: 初始化配置` 即可。

**Q: 提交信息预览弹窗显示不全怎么办？**  
A: 如果提交信息超过 300 字符，会自动截断。点击"打开源代码管理"按钮可以查看完整内容。

**Q: 如何关闭项目切换检测？**  
A: 当弹出提示时，选择"不再提示"即可。如果已经关闭了，想重新开启，可以删除 `.cursorrules` 文件，切换项目后会再次提示。

**Q: 使用统计标记会影响 Git 历史吗？**  
A: 不会！标记符合 Git trailer 标准格式（与 `Signed-off-by` 一样），是 Git 标准功能，不会影响提交历史或团队协作。

---

## 反馈与建议

如果您在使用新功能时遇到任何问题，或有改进建议，请访问：

- **GitHub Issues**: https://github.com/snake-mustang/sy-ai-commit/issues

---

## 致谢

感谢所有用户的反馈和建议，让 sy-ai-commit 变得更好！

**⭐️ 觉得新功能好用？给个 Star 支持一下！**

**🎉 享受更智能的 Git 提交体验！**

