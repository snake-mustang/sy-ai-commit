# v1.2.0 功能测试计划

## 测试环境准备

### 1. 安装测试版本

```powershell
# 在 VS Code/Cursor 中安装 .vsix 文件
# 方法 1：命令面板
# Ctrl+Shift+P → "Extensions: Install from VSIX..." → 选择 sy-ai-commit-1.2.0.vsix

# 方法 2：命令行
code --install-extension sy-ai-commit-1.2.0.vsix
# 或
cursor --install-extension sy-ai-commit-1.2.0.vsix
```

### 2. 准备测试项目

需要准备 3 个测试项目：

**项目 A：未初始化项目**
- 一个全新的 Git 项目
- 没有 `.cursorrules` 文件
- 用于测试"未初始化"提示

**项目 B：已初始化项目**
- 已运行过 `sy commit: 初始化配置`
- 有 `.cursorrules` 文件且包含 Git 提交规则
- 用于测试不弹出提示的情况

**项目 C：部分配置项目**
- 有 `.cursorrules` 文件但不包含 Git 提交规则
- 用于测试"未包含 Git 提交规则"提示

---

## 测试用例 1：项目切换检测功能 🔔

### 测试 1.1：未初始化项目检测

**步骤：**
1. 打开 Cursor/VS Code
2. 打开项目 A（未初始化项目）
3. 等待 2-3 秒

**预期结果：**
- ✅ 应该弹出提示：
  ```
  ⚠️ 当前项目未初始化 sy-ai-commit
  
  检测到您切换了项目，但当前项目未配置 sy-ai-commit。
  是否立即初始化？
  
  [立即初始化]  [稍后]  [不再提示]
  ```

**测试点：**
- [ ] 提示是否正确弹出
- [ ] 提示内容是否正确
- [ ] 提示是非模态的（可以点击其他地方关闭）

---

### 测试 1.2：立即初始化功能

**步骤：**
1. 在测试 1.1 的基础上，点击"立即初始化"按钮
2. 等待配置完成

**预期结果：**
- ✅ 执行完整的初始化流程
- ✅ 显示进度条
- ✅ 配置完成后弹出成功提示
- ✅ 项目根目录生成 `.cursorrules` 文件
- ✅ `keybindings.json` 添加快捷键配置

**测试点：**
- [ ] 初始化流程是否正常执行
- [ ] `.cursorrules` 文件是否正确创建
- [ ] 快捷键是否配置成功

---

### 测试 1.3：稍后初始化

**步骤：**
1. 重新打开项目 A（先删除 `.cursorrules` 文件）
2. 弹出提示时，点击"稍后"
3. 关闭项目，再次打开项目 A

**预期结果：**
- ✅ 点击"稍后"后提示关闭
- ✅ 再次打开项目时，应该再次弹出提示

**测试点：**
- [ ] "稍后"按钮是否生效
- [ ] 再次打开是否重新提示

---

### 测试 1.4：不再提示

**步骤：**
1. 重新打开项目 A
2. 弹出提示时，点击"不再提示"
3. 关闭项目，再次打开项目 A

**预期结果：**
- ✅ 点击"不再提示"后，该项目不再弹出提示
- ✅ 配置 `autoSetupOnStartup` 设置为 `false`（工作区级别）

**测试点：**
- [ ] "不再提示"按钮是否生效
- [ ] 设置是否正确保存

---

### 测试 1.5：已初始化项目不提示

**步骤：**
1. 打开项目 B（已初始化项目）
2. 等待 2-3 秒

**预期结果：**
- ✅ 不应该弹出任何提示
- ✅ 扩展正常工作

**测试点：**
- [ ] 是否没有弹出提示
- [ ] 快捷键是否正常工作

---

### 测试 1.6：部分配置项目检测

**步骤：**
1. 在项目 C 的根目录创建一个 `.cursorrules` 文件
2. 写入一些内容，但不包含 "When generating git commit messages"
3. 打开项目 C
4. 等待 2-3 秒

**预期结果：**
- ✅ 应该弹出提示：
  ```
  ⚠️ 当前项目的 .cursorrules 未包含 Git 提交规则
  
  是否要添加 sy-ai-commit 的 Git 提交规则？
  
  [添加规则]  [稍后]
  ```

**测试点：**
- [ ] 提示是否正确弹出
- [ ] 提示内容是否正确

---

### 测试 1.7：工作区切换检测

**步骤：**
1. 打开项目 B（已初始化）
2. 通过 "文件 → 打开文件夹" 切换到项目 A（未初始化）

**预期结果：**
- ✅ 切换到项目 A 后，应该立即弹出初始化提示

**测试点：**
- [ ] 工作区切换事件是否触发
- [ ] 提示是否正确弹出

---

## 测试用例 2：提交信息即时预览功能 📝

### 测试前准备

确保在已初始化的项目中测试（项目 B）

---

### 测试 2.1：生成短文本提交信息

**步骤：**
1. 在项目 B 中修改一个文件（小改动）
2. 按 `Ctrl+T Ctrl+T`
3. 等待生成完成

**预期结果：**
- ✅ 显示进度条
- ✅ 弹出成功提示窗口
- ✅ 窗口中显示生成的提交信息内容
- ✅ 提交信息完整显示（未截断）
- ✅ 窗口格式如下：
  ```
  ✅ 已生成提交信息！
  
  📝 生成的提交信息：
  ━━━━━━━━━━━━━━━━━━━━
  Feat(测试): 测试功能
  
  - 修改测试文件
  
  Generated-by: sy-ai-commit@1.2.0
  ━━━━━━━━━━━━━━━━━━━━
  
  👉 下一步：查看提交信息并点击"提交"按钮（或按 Ctrl+Enter）
  
  [打开源代码管理]  [知道了]
  ```

**测试点：**
- [ ] 提交信息是否正确显示
- [ ] 格式是否正确
- [ ] 包含 Generated-by 标记

---

### 测试 2.2：生成长文本提交信息

**步骤：**
1. 在项目 B 中修改多个文件（大改动）
2. 按 `Ctrl+T Ctrl+T`
3. 等待生成完成

**预期结果：**
- ✅ 显示进度条
- ✅ 弹出成功提示窗口
- ✅ 如果提交信息超过 300 字符，应该截断
- ✅ 显示截断提示：`(完整内容请在源代码管理面板查看)`

**测试点：**
- [ ] 长文本是否正确截断
- [ ] 截断提示是否显示
- [ ] 截断位置是否合理

---

### 测试 2.3：打开源代码管理按钮

**步骤：**
1. 生成提交信息后（测试 2.1 或 2.2）
2. 点击"打开源代码管理"按钮

**预期结果：**
- ✅ 自动切换到源代码管理视图
- ✅ 提交信息已填入输入框
- ✅ 可以看到完整的提交信息内容

**测试点：**
- [ ] 是否正确打开源代码管理面板
- [ ] 提交信息是否已填入
- [ ] 内容是否完整

---

### 测试 2.4：知道了按钮

**步骤：**
1. 生成提交信息后
2. 点击"知道了"按钮

**预期结果：**
- ✅ 弹窗关闭
- ✅ 提交信息已填入源代码管理面板
- ✅ 可以手动切换到源代码管理面板查看

**测试点：**
- [ ] 弹窗是否关闭
- [ ] 提交信息是否保留

---

### 测试 2.5：完整提交流程

**步骤：**
1. 修改文件
2. 按 `Ctrl+T Ctrl+T` 生成提交信息
3. 在弹窗中预览提交信息
4. 点击"打开源代码管理"
5. 在源代码管理面板点击"提交"按钮（或按 Ctrl+Enter）

**预期结果：**
- ✅ 提交成功
- ✅ 提交信息包含 Generated-by 标记

**测试点：**
- [ ] 完整流程是否顺畅
- [ ] 提交是否成功
- [ ] 提交信息是否正确

---

## 测试用例 3：使用统计功能验证 📊

### 测试 3.1：验证 Generated-by 标记

**步骤：**
1. 完成测试 2.5 的提交
2. 在终端运行：
   ```bash
   git log -1 --format=full
   ```

**预期结果：**
- ✅ 最新的提交信息末尾包含：
  ```
  Generated-by: sy-ai-commit@1.2.0
  ```

**测试点：**
- [ ] 标记是否存在
- [ ] 版本号是否正确
- [ ] 格式是否符合 Git trailer 标准

---

### 测试 3.2：统计命令验证

**步骤：**
1. 在终端运行统计命令：
   ```bash
   git log --grep="Generated-by: sy-ai-commit"
   ```

**预期结果：**
- ✅ 显示所有使用扩展提交的记录

**测试点：**
- [ ] 是否能正确查询
- [ ] 结果是否准确

---

### 测试 3.3：关闭标记功能

**步骤：**
1. 打开设置（Ctrl+,）
2. 搜索 `autoCommitAssistant.addGeneratedByTrailer`
3. 设置为 `false`
4. 修改文件，按 `Ctrl+T Ctrl+T` 生成提交信息
5. 查看生成的提交信息

**预期结果：**
- ✅ 提交信息不包含 `Generated-by` 标记

**测试点：**
- [ ] 设置是否生效
- [ ] 标记是否已移除

---

## 测试用例 4：一键提交功能（Ctrl+G Ctrl+G）

### 测试 4.1：一键提交流程

**步骤：**
1. 修改文件
2. 按 `Ctrl+G Ctrl+G`
3. 等待完成

**预期结果：**
- ✅ 显示进度条（保存 → 暂存 → 生成 → 添加标记 → 提交）
- ✅ 弹出成功提示
- ✅ 提交已完成
- ✅ 提交信息包含 Generated-by 标记

**测试点：**
- [ ] 流程是否完整执行
- [ ] 提交是否成功
- [ ] 标记是否添加

---

## 测试结果记录

### 功能 1：项目切换检测

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1.1 未初始化项目检测 | ⬜ 待测试 | |
| 1.2 立即初始化功能 | ⬜ 待测试 | |
| 1.3 稍后初始化 | ⬜ 待测试 | |
| 1.4 不再提示 | ⬜ 待测试 | |
| 1.5 已初始化项目不提示 | ⬜ 待测试 | |
| 1.6 部分配置项目检测 | ⬜ 待测试 | |
| 1.7 工作区切换检测 | ⬜ 待测试 | |

### 功能 2：提交信息预览

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 2.1 生成短文本提交信息 | ⬜ 待测试 | |
| 2.2 生成长文本提交信息 | ⬜ 待测试 | |
| 2.3 打开源代码管理按钮 | ⬜ 待测试 | |
| 2.4 知道了按钮 | ⬜ 待测试 | |
| 2.5 完整提交流程 | ⬜ 待测试 | |

### 功能 3：使用统计

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 3.1 验证 Generated-by 标记 | ⬜ 待测试 | |
| 3.2 统计命令验证 | ⬜ 待测试 | |
| 3.3 关闭标记功能 | ⬜ 待测试 | |

### 功能 4：一键提交

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 4.1 一键提交流程 | ⬜ 待测试 | |

---

## 常见问题排查

### 问题 1：提示没有弹出

**可能原因：**
- 项目已经初始化过
- 之前选择了"不再提示"
- 工作区切换事件未触发

**排查方法：**
1. 检查项目根目录是否有 `.cursorrules` 文件
2. 检查设置中 `autoSetupOnStartup` 是否为 `false`
3. 查看开发者工具控制台是否有错误信息

---

### 问题 2：提交信息没有显示

**可能原因：**
- Git 扩展 API 获取失败
- 提交信息为空

**排查方法：**
1. 打开开发者工具（帮助 → 切换开发人员工具）
2. 查看控制台是否有错误信息
3. 手动打开源代码管理面板查看提交信息是否存在

---

### 问题 3：标记没有添加

**可能原因：**
- 配置 `addGeneratedByTrailer` 设置为 `false`
- Git 扩展 API 调用失败

**排查方法：**
1. 检查设置中 `autoCommitAssistant.addGeneratedByTrailer` 的值
2. 查看控制台错误信息

---

## 测试完成后

### 1. 更新测试结果

将上面的测试结果表格中的 ⬜ 更新为：
- ✅ 通过
- ❌ 失败
- ⚠️ 部分通过

### 2. 记录问题

如果发现问题，记录：
- 问题描述
- 复现步骤
- 预期结果 vs 实际结果
- 错误信息（如果有）

### 3. 验收标准

**必须全部通过的测试：**
- 测试 1.1, 1.2, 1.5（核心功能）
- 测试 2.1, 2.3, 2.5（核心功能）
- 测试 3.1（使用统计）
- 测试 4.1（一键提交）

**可以有小问题的测试：**
- 测试 1.3, 1.4（边界情况）
- 测试 2.2（长文本截断）
- 测试 3.2, 3.3（辅助功能）

---

## 测试环境信息

**请填写：**
- 操作系统：Windows / macOS / Linux
- 编辑器：Cursor / VS Code
- 编辑器版本：
- 扩展版本：1.2.0
- Node.js 版本：
- Git 版本：

---

**测试日期：**  
**测试人员：**  
**测试结果：** ⬜ 通过 / ⬜ 失败 / ⬜ 部分通过

